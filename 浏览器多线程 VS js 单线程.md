### 浏览器的多线程 vs js 单线程  
#####前沿  
最近接触到React 框架的核心算法更新换代了，业界成为Fiber，Fiber的到来让React焕然一新，有了一个质的飞越，js单线程和浏览器多线程的机制反推React必须做出改进。那么js单线程和浏览器多线程背后是怎么工作的，下来我们将详细讲解~  

#### 1. 知识点补充  
#####js 单线程  
js运作在浏览器中，是单线程的，js代码始终在一个线程上执行，此线程被称为js引擎线程。  
ps： web worker 也只是允许javascript 脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。  
js 单线程的任务分为两种， 一种是同步任务（synchronous）；一种是异步任务（asynchronous）；  
##### 浏览器多线程  
1. js引擎线程（js引擎有多个线程，一个主线程，其他的后台配合主线程）
作用： 执行js任务  
2. ui渲染线程  
作用： 渲染页面（js可以操作DOM，影响渲染，所以js引擎线程和ui线程是互斥的。js执行时会阻塞页面的渲染）  
3. 浏览器事件触发线程  
作用： 控制交互，响应用户  
4. http请求线程  
作用： ajax 请求等  
5. 定时触发器线程  
作用： setTimeout 和setInterval  
6. 事件轮询处理线程  
作用： 轮询消息队列，event loop  
#### 同步任务和异步任务  
同步任务： 在主线程排队的任务，前一个任务执行完毕后，执行后一个任务，行一个执行栈，线程执行时在内存形成的空间为栈，进程形成堆结构，这是内存的结构。执行栈可以实现函数的层层调用。  
异步任务会被主线程挂起，不会进入主线程，而是进入消息队列，而且必须指定回调函数，只有消息队列通知主线程，并且执行栈为空时，该消息对应的任务才会进入执行站获得执行的机会。  

js运行机制：  
1. 所有同步任务都在主线程上执行，形成一个执行栈。  
2. 主线程之外，还存在一个任务队列。只要异步任务有了运行结果，就在任务队列之中放置一个事件。  
3. 一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，看看里面有哪些事件。执行相应的异步任务，就如执行栈。  
4. 主线程不断重复上面的第三步。  
![](https://img-blog.csdn.net/20170802151038554?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2l0aHViXzM0NTE0NzUw/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)  

####js引擎线程和UI线程互斥  
例如我们导出数据，每次从后台请求100条数据，最后拼接成文件。同时，才下载之前修改dom，显示loading效果。导出之后，取消loading效果。  
考虑每次都要用到响应结果，则使用同步ajax，但dom就被阻塞。
	function getData1(){
        $('.loadingicon').show();
        $.ajax({
            url : '',
            async : false,
            success: function(data){
                $('.loadingicon').hide();
                alert(data);
            }
        });
	}    


























